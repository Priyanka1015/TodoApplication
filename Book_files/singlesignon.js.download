function $_global_singlesignon(){if("undefined"==typeof g_all_modules)g_all_modules={};g_all_modules["singlesignon.js"]={version:{rmj:16,rmm:0,rup:9124,rpr:1233}};typeof spWriteProfilerMark=="function"&&spWriteProfilerMark("perfMarkBegin_singlesignon.js");RefreshTokenInProgress=false;(function(){var a=null,c=false;function k(b,d){if(c)b();else{var e="https://secure.aadcdn.microsoftonline-p.com/lib/1.0.16/js/adal.min.js",a=document.createElement("script");a.src=e;if(typeof a.onreadystatechange!="function")a.onload=function(){c=true;b()};else a.onreadystatechange=function(){if(typeof a.readyState!="undefined"&&/^(complete|loaded)$/.test(a.readyState)){c=true;setTimeout(b,0)}};a.onerror=d;a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a)}}function f(){return window.location.protocol+"//"+window.location.host}function j(b){var a=document.getElementById(b);Boolean(a)&&document.body.removeChild(a)}function e(a){Boolean(SP)&&Boolean(SP.QoS)&&Boolean(SP.QoS.WriteStart)&&SP.QoS.WriteStart(a)}function d(b,c,d,a){if(Boolean(SP)&&Boolean(SP.QoS)&&Boolean(SP.QoS.WriteSuccess))if(Boolean(c)||!Boolean(d))SP.QoS.WriteFailure(b+"_Failure",{TokenRequestTime:a});else SP.QoS.WriteSuccess(b+"_Success",{TokenRequestTime:a})}function b(d,b){var a={};a.Tokens=d;var c={MessageId:"Host_RefreshSessionInfo",SendTime:Date.now(),Values:a},e=document.getElementById("WebApplicationFrame").contentWindow;e.postMessage(JSON.stringify(c),b)}function g(a){return typeof a=="undefined"||a==null}function h(){return Flighting.VariantConfiguration.IsExpFeatureClientEnabled(1332)}function i(){return Flighting.VariantConfiguration.IsExpFeatureClientEnabled(1401)}GetAccessTokenForAddin=function(c,l,b,g,m){g=g===undefined?false:g;var o=function(){var x,k,q=0,r=0,o;if(!Boolean(a)){var u=null,w=null,v="57fb890c-0dab-4253-a5e0-7188c88b2bb4",y=f()+"/_forms/singlesignon.aspx",t=null;if(g){if(i())if(Boolean(_spPageContextInfo)){var B=(_spPageContextInfo.webDomain.startsWith(".")?_spPageContextInfo.webDomain:"."+_spPageContextInfo.webDomain).toLowerCase(),A=_spPageContextInfo.webAbsoluteUrl.toLowerCase(),s=document.createElement("a");s.href=A;if(!s.hostname.endsWith(B)&&!s.hostname.endsWith(".sharepoint-df.com")){b("DomainNotSupported",null);return}}if(h())v="6da96ed5-354b-4130-ae74-7882233b300b";else v="08e18876-6177-487e-b8b5-cf950c1e598c";y=f()+"/_forms/spfxsinglesignon.aspx";t=m===null||m===undefined||m===""?null:"scope="+m}if(Boolean(_spPageContextInfo)&&Boolean(_spPageContextInfo.aadInstanceUrl)&&Boolean(_spPageContextInfo.aadTenantId)){u=_spPageContextInfo.aadInstanceUrl+"/";w=_spPageContextInfo.aadTenantId}(!Boolean(u)||!Boolean(w))&&b("Environment not supported",null);var z={tenant:w,instance:u,clientId:v,redirectUri:y,popUp:true,navigateToLoginRequestUrl:false,loadFrameTimeout:3e4};if(g)z.extraQueryParameter=t;a=new AuthenticationContext(z);if(Boolean(_spPageContextInfo)&&(Boolean(_spPageContextInfo.userEmail)||Boolean(_spPageContextInfo.userLoginName)&&!_spPageContextInfo.userLoginName.startsWith("urn:spo:anon#")))a._user={profile:{upn:Boolean(_spPageContextInfo.userLoginName)?_spPageContextInfo.userLoginName:_spPageContextInfo.userEmail}}}var n={acquireTokenPopup:"acquireTokenPopup",login:"login"},p=function(m,y){var i,f={SignIn:0,Close:1},h=function(g){var j=g==f.SignIn?SP.UI.DialogResult.OK:SP.UI.DialogResult.cancel;i.close(j);if(g==f.SignIn){m==n.acquireTokenPopup&&a.acquireTokenPopup(c,t,y,function(a,c){b(a,c)});if(m==n.login){e("GetIdToken_Start");var h=+new Date;a.callback=function(f,g){var i=+new Date;d("GetIdToken",f,g,i-h);if(Boolean(f)||!Boolean(g))b(f,g);else{x=a.getCachedUser();if(Boolean(l))p(n.acquireTokenPopup,l);else{k=a.getCachedToken(c);if(Boolean(k))o(null,k);else{e("GetAccessToken_Start");q=+new Date;a.acquireToken(c,function(a,b){r=+new Date;d("GetAccessToken",a,b,r-q);o(a,b)})}}}};a.login()}}},u=function(a){if(a==SP.UI.DialogResult.cancel)b("SSO13002: user aborted.",null);else a==SP.UI.DialogResult.invalid&&b("invalid dialog resource.",null)},v=["<div>",STSHtmlEncode(Strings.STS.L_SSOSignInNeededNotification_Description_Text),"</div>","<div class='ms-core-form-bottomButtonBox'>","<button id='js-signinBtn' class='ms-button-enphasize'>",STSHtmlEncode(Strings.STS.L_SSOSignInNeededNotification_SignInButton_Text),"</button>","<button id='js-closeBtn' class='ms-ButtonHeightWidth'>",STSHtmlEncode(Strings.STS.L_SSOSignInNeededNotification_CloseButton_Text),"</button></div>"],s=document.createElement("div");s.innerHTML=v.join("");var w={html:s,width:450,autoSize:true,title:Strings.STS.L_SSOSignInNeededNotification_Title_Text,dialogReturnValueCallback:u};i=new SP.UI.ModalDialog.showModalDialog(w);var g=document.getElementById("js-signinBtn");if(Boolean(g)){g.onclick=function(){h(f.SignIn)};g.focus()}var j=document.getElementById("js-closeBtn");if(Boolean(j))j.onclick=function(){h(f.Close)}};o=function(a,d){j("adalRenewFrame"+c);if(Boolean(a)&&(a.indexOf("AADSTS50079")>-1||a.indexOf("AADSTS50076")>-1||a.indexOf("AADSTS50072")>-1))p(n.acquireTokenPopup,null);else b(a,d)};x=a.getCachedUser();if(x)if(Boolean(l))p(n.acquireTokenPopup,l);else{k=a.getCachedToken(c);if(Boolean(k))o(null,k);else{e("GetAccessToken_Start");q=+new Date;a.acquireToken(c,function(a,b){r=+new Date;d("GetAccessToken",a,b,r-q);o(a,b)})}}else p(n.login,null)},n=function(){b("adal.js load failed",null)};k(o,n)};RefreshToken=function(w,o,m,c,k){var e=[],d=[];if(RefreshTokenInProgress){SP.DebugLogger.Write("RefreshAccessToken",SP.DebugLogger.LoggingLevel.Interesting,"Already a request in progress so cancelling this one");d.push({Id:"202",Details:"Call in progress"});for(var r=0;r<c.length;r++)e.push({Name:c[l],Errors:d});b(e,k);return}var x=_spPageContextInfo.webId,v=_spPageContextInfo.siteId,t=window.location.hostname,i,p=-1,q=-1,u=w+"/_api/v2.0/sites/"+t,h=u+","+v+","+x+"/lists/"+o+"/items/"+m+"/driveItem?expand=openWith";h=h.replace(/[{}]/g,"");var a=new XMLHttpRequest;a.open("GET",h,true);a.setRequestHeader("Content-type","application/json;odata=verbose");var n="Refresh Token",f=new SP.QoS.ScenarioMonitor("RefreshAccessToken","RefreshAccessToken.Start","RefreshAccessToken.Success","RefreshAccessToken.Failure","RefreshAccessToken.NoResult");if(o==null||m==null||o==""||m=="-1"){f.ExpectedFailure("RefreshAccessToken.InvalidIds.ExpectedFailure",{vroomItemUrl:h,ErrorCode:"InvalidIds"});d.push({Id:"Invalid Ids",Details:"Invalid Ids"});for(var l=0;l<c.length;l++)e.push({Name:c[l],Errors:d});b(e,k);return}if(!Array.contains(c,"AccessToken")&&!Array.contains(c,"FileGetUrl")){SP.DebugLogger.Write("RefreshAccessToken",SP.DebugLogger.LoggingLevel.Interesting,"Unknown token request received");f.ExpectedFailure("RefreshAccessToken.UnknownTokenRequest.ExpectedFailure",{requestedTokens:c.toString(),ErrorCode:"UnknownTokenRequest"});d.push({Id:"Unknown token",Details:"Unknown token"});for(var j=0;j<c.length;j++)e.push({Name:c[j],Errors:d});b(e,k);return}var s=+new Date;a.onreadystatechange=function(){if(a.readyState==4){var o=+new Date;i=a.getResponseHeader("SPRequestGuid");p=Number(a.getResponseHeader("SPClientServiceRequestDuration"));q=Number(a.getResponseHeader("SPIisLatency"));EnsureScriptFunc("sp.core.js","SP.SlapiInternal",function(){var a=g(PerformanceLogger)?null:PerformanceLogger.GetLogger();if(!g(a)){a.ResetPerformanceLogger();a.CollectW3CPerfTimings();a.WriteScenarioId(n);a.WritePageTransitionType(4);a.WriteServerCorrelationId(i);a.WriteAppCache(false);a.WriteFolderNav(false);a.WriteServerSideLatency(p,q);if(typeof PerformanceLogger.ControlPerformanceData=="function"){a.AddExpectedControl(n);var b=new PerformanceLogger.ControlPerformanceData(n,s,Number(o),a.ComputeControlRenderTime,a.CheckControlTimeRequiredDataAvailable);a.WriteControlPerformanceData(b)}}});RefreshTokenInProgress=false;if(a.status===200){var l=null,m="No tokens retrieved";try{l=JSON.parse(a.responseText)}catch(r){SP.DebugLogger.Write("RefreshAccessToken_UnexpectedFailure",SP.DebugLogger.LoggingLevel.Interesting,r);f.UnexpectedFailure("RefreshAccessToken.Error.UnexpectedFailure",{CorrelationId:i,response:l,Error:r,vroomItemUrl:h});m=r}if(Boolean(l)&&Boolean(l.error)){SP.DebugLogger.Write("RefreshAccessToken_UnexpectedFailure",SP.DebugLogger.LoggingLevel.Interesting,l.error);f.UnexpectedFailure("RefreshAccessToken.Error.UnexpectedFailure",{CorrelationId:i,Error:l.error,requestedTokens:c.toString(),vroomItemUrl:h,ErrorCode:l.error.code});d.push({Id:l.error.code,Details:l.error.message})}else if(Boolean(l)&&Boolean(l.openWith)&&Boolean(l.openWith.wac)){f.Success("RefreshAccessToken.Success");Array.contains(c,"AccessToken")&&e.push({Name:"AccessToken",Value:l.openWith.wac.accessToken,Expiry:l.openWith.wac.accessTokenExpiry});Array.contains(c,"FileGetUrl")&&e.push({Name:"FileGetUrl",Value:l.openWith.wac.fileGetUrl,Expiry:l.openWith.wac.accessTokenExpiry})}else{d.push({Id:"500",Details:m});f.UnexpectedFailure("RefreshAccessToken.NoToken.UnexpectedFailure",{CorrelationId:i,vroomItemUrl:h,requestedTokens:c.toString(),response:l,ErrorCode:"NoToken"})}}else if(a.status==0){d.push({Id:"503",Details:"Unable to connect to Service"});f.ExpectedFailure("RefreshAccessToken.UnableToConnect.ExpectedFailure",{ErrorCode:"UnableToConnect"})}else{if(a.status==503)d.push({Id:a.status,Details:"Service Unavailable"});else d.push({Id:a.status,Details:a.responseText});if(a.status==401||a.status==404||a.status==403||a.status==423)f.ExpectedFailure("RefreshAccessToken.ApiCallFailed.ExpectedFailure",{CorrelationId:i,requestedTokens:c.toString(),vroomItemUrl:h,Status:a.status,Details:a.responseText,ErrorCode:a.status});else f.UnexpectedFailure("RefreshAccessToken.ApiCallFailed.UnexpectedFailure",{CorrelationId:i,requestedTokens:c.toString(),vroomItemUrl:h,Status:a.status,Details:a.responseText,ErrorCode:a.status})}if(d.length>0)for(j=0;j<c.length;j++)e.push({Name:c[j],Errors:d});b(e,k);f.Dispose()}else RefreshTokenInProgress=true};a.send()};GetPrimaryIdentityInfoForAddin=function(b){var a={};a.UserName="";a.UserEmail="";a.HostApplicationType="SharePointOnline";a.FederationProvider="";if(Boolean(_spPageContextInfo))if(Boolean(_spPageContextInfo.userEmail)||Boolean(_spPageContextInfo.userLoginName)&&!_spPageContextInfo.userLoginName.startsWith("urn:spo:anon#")){a.UserName=_spPageContextInfo.userDisplayName;a.UserEmail=Boolean(_spPageContextInfo.userLoginName)?_spPageContextInfo.userLoginName:_spPageContextInfo.userEmail}b(0,JSON.stringify(a))}})();(function(){typeof Sys!="undefined"&&typeof Sys.Application!="undefined"&&typeof Sys.Application.notifyScriptLoaded!="undefined"&&Sys.Application.notifyScriptLoaded();typeof NotifyScriptLoadedAndExecuteWaitingJobs=="function"&&NotifyScriptLoadedAndExecuteWaitingJobs("singlesignon.js")})();typeof spWriteProfilerMark=="function"&&spWriteProfilerMark("perfMarkEnd_singlesignon.js")}var GetAccessTokenForAddin,GetPrimaryIdentityInfoForAddin,RefreshToken,RefreshTokenInProgress;$_global_singlesignon();